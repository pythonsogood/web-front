<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
		<style>
			li input:checked + label {
				text-decoration: line-through;
			}
		</style>
		<script>
			const TASKS = [];

			function onFormSubmit() {
				const form = document.querySelector("form");
				const input = form.querySelector("input");
				const task = input.value;

				addTask(task);
			}

			function addTask(task) {
				const element = marked.parse(task);

				const ul = document.querySelector("ul");

				const child = document.createElement("li");
				child.classList.add("list-group-item");

				const childCheckbox = document.createElement("input");
				childCheckbox.type = "checkbox";
				childCheckbox.value = "";
				childCheckbox.classList.add("form-check-input", "me-1", "mt-0", "align-middle");
				child.appendChild(childCheckbox);

				child.appendChild(document.createTextNode("\u00A0")); // "whitespace" element

				const childLabel = document.createElement("label");
				childLabel.classList.add("form-check-label", "align-middle");
				childLabel.innerHTML = element;
				childLabel.firstChild.classList.add("mb-0");
				child.appendChild(childLabel);

				const childDelete = document.createElement("button");
				childDelete.classList.add("btn", "btn-danger", "btn-sm", "float-end", "align-middle");
				childDelete.innerText = "Delete";
				child.appendChild(childDelete);

				ul.appendChild(child);

				const taskObj = {
					task: task,
					element: element,
					child: child,
					completed: false,
				}

				TASKS.push(taskObj);

				childCheckbox.oninput = () => {taskObj.completed = childCheckbox.checked};
				childDelete.onclick = removeTask.bind(this, taskObj);

				return taskObj;
			}

			function removeTask(task) {
				task.child.parentNode.removeChild(task.child);

				TASKS.pop(TASKS.indexOf(task));
			}

			function completeTask(task) {
				task.completed = true;
				task.child.querySelector("input").checked = true;
			}

			function uncompleteTask(task) {
				task.completed = false;
				task.child.querySelector("input").checked = false;
			}

			function toggleTaskCompletion(task) {
				task.completed = !task.completed;
				task.child.querySelector("input").checked = task.completed;
			}
		</script>
	</head>
	<body>
		<main>
			<div class="container">
				<h3>To-Do</h1>
				<ul class="list-group"></ul>
			</div>

			<div class="container">
				<form class="row gap-2 ms-0" onsubmit="event.preventDefault(); onFormSubmit();" autocomplete="off">
					<div class="row">
						<div class="col">
							<label for="task" class="form-label">Task</label>
							<input class="form-control" id="task" maxlength="256" required>
						</div>
					</div>
					<div class="row">
						<button type="submit" class="col btn btn-primary">Add Task</button>
					</div>
				</form>
			</div>
		</main>
	</body>
</html>